(()=>{"use strict";var e=document.querySelectorAll(".popup");function t(t){"Escape"===t.key&&e.forEach(o)}function o(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",t)}function n(e){e.classList.add("popup_opened"),document.addEventListener("keydown",t)}function r(e){e.target===e.currentTarget&&o(e.target)}var c={baseUrl:"https://mesto.nomoreparties.co/v1/wbf-cohort-13",headers:{authorization:"1e318b4e-cce3-4adb-b5d8-1e538170c490","Content-Type":"application/json"}},a=document.querySelector("#edit-profile-popup"),u=document.querySelector(".profile__edit-button"),i=document.querySelector(".profile__name"),s=document.querySelector(".profile__about"),l=document.querySelector(".profile__avatar"),d=document.forms["edit-profile"],f=d.querySelector("#profile-name"),p=d.querySelector("#profile-about"),m=d.querySelector(".form__submit-button");function h(e){i.textContent=e.name,s.textContent=e.about,l.src=e.avatar,i.id=e._id}fetch("".concat(c.baseUrl,"/users/me"),{headers:c.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return h(e)})).catch((function(e){return console.log("".concat(e,". Не удалось загрузить данные пользователя."))}));var v=document.querySelector("#add-post-popup"),_=document.querySelector("#view-photo-popup"),y=document.querySelector(".feed"),S=document.forms["add-post"],b=S.querySelector("#post-name"),q=S.querySelector("#post-link"),E=S.querySelector(".form__submit-button"),k=document.querySelector("#post-template").content;function L(e){var t=k.querySelector(".post").cloneNode(!0),o=t.querySelector(".post__photo"),n=t.querySelector(".post__like-button"),r=t.querySelector(".post__like-amount"),a=t.querySelector(".post__delete-button");function u(e){r.textContent=e.likes.length,e.likes.some((function(e){return e._id===i.id}))&&n.classList.toggle("post__like-button_is-liked")}return o.src=e.link,o.alt=e.name,u(e),function(e){e.owner._id!==i.id&&a.classList.add("post__delete-button_hide")}(e),t.querySelector(".post__name").textContent=e.name,t.id=e._id,n.addEventListener("click",(function(){var t,o;n.classList.contains("post__like-button_is-liked")&&(o=e._id,fetch("".concat(c.baseUrl,"/cards/likes/").concat(o),{method:"DELETE",headers:c.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){u(e)})).catch((function(e){console.log("".concat(e,". Удалить лайк не получилось, попробуйте позже."))})),(t=e._id,fetch("".concat(c.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:c.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){u(e)})).catch((function(e){console.log("".concat(e,". Добавить лайк не получилось, попробуйте позже."))}))})),a.addEventListener("click",(function(){var e;(e=t.id,fetch("".concat(c.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:c.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(){t.remove()})).catch((function(e){console.log("".concat(e,". Удалить не получилось, попробуйте позже."))}))})),t}_.querySelector(".popup__photo"),_.querySelector(".popup__photo-name");var C,g=document.querySelector("#edit-avatar-popup"),j=document.querySelector(".profile__avatar"),x=document.querySelector(".profile__avatar-area"),P=document.forms["edit-avatar"],U=P.querySelector("#avatar-link"),T=P.querySelector(".form__submit-button");C={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__submit-button",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"},Array.from(document.querySelectorAll(C.formSelector)).forEach((function(e){return function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,o){t.validity.valid?function(e,t,o){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""}(e,t,o):function(e,t,o,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)}(e,t,t.validationMessage,o)}(e,r,t),function(e,t){t.disabled=e.some((function(e){return!e.validity.valid}))}(o,n)}))}))}(e,C)})),e.forEach((function(e){e.addEventListener("mousedown",r),e.querySelector(".popup__close-button").addEventListener("click",(function(){return o(e)}))}));var w=document.querySelector(".profile__add-post-button");document.addEventListener("DOMContentLoaded",(function(){fetch("".concat(c.baseUrl,"/cards"),{headers:c.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){return t=e,void y.append(L(t));var t}))})).catch((function(e){console.log("".concat(e,". Не получилось подгрузить ваши посты."))}))})),u.addEventListener("click",(function(){f.value=i.textContent,p.value=s.textContent;var e=new Event("input",{bubbles:!0});f.dispatchEvent(e),p.dispatchEvent(e),n(a)})),d.addEventListener("submit",(function(e){var t,n;e.preventDefault(),m.textContent="Сохранение...",(t=f.value,n=p.value,fetch("".concat(c.baseUrl,"/users/me"),{method:"PATCH",headers:c.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){h(e),o(a)})).catch((function(e){console.log("".concat(e,". Не удалось обновить данные пользователя."))})).finally((function(){m.textContent="Сохранить"}))})),w.addEventListener("click",(function(){n(v)})),S.addEventListener("submit",(function(e){var t,n;e.preventDefault(),E.textContent="Создание...",(t=b.value,n=q.value,fetch("".concat(c.baseUrl,"/cards"),{method:"POST",headers:c.headers,body:JSON.stringify({name:t,link:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(t){y.prepend(L(t)),o(v),e.target.reset()})).catch((function(e){console.log("".concat(e,". Добавить не получилось, попробуйте позже."))})).finally((function(){E.textContent="Создать"}))})),x.addEventListener("click",(function(){U.value=j.src,n(g)})),P.addEventListener("submit",(function(e){var t;e.preventDefault(),T.textContent="Сохранение...",(t=U.value,fetch("".concat(c.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){j.src=U.value,o(g)})).catch((function(e){console.log("".concat(e,". Не удалось обновить аватар пользователя."))})).finally((function(){T.textContent="Сохранить"}))}))})();